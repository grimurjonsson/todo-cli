---
phase: 01-clipboard-support
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [src/keybindings/mod.rs, src/app/event.rs]
autonomous: true

must_haves:
  truths:
    - "User can press y in Navigate mode to copy selected todo text"
    - "Status bar shows 'Copied: [text]' after successful copy"
    - "Status bar shows error message when clipboard unavailable"
    - "Copied text is plain content only (no checkbox, no markdown)"
  artifacts:
    - path: "src/keybindings/mod.rs"
      provides: "Yank action definition and y keybinding"
      contains: "Action::Yank"
    - path: "src/app/event.rs"
      provides: "Yank action handler with clipboard integration"
      contains: "copy_to_clipboard"
  key_links:
    - from: "src/app/event.rs"
      to: "src/clipboard.rs"
      via: "use crate::clipboard::copy_to_clipboard"
      pattern: "use crate::clipboard::copy_to_clipboard"
    - from: "src/keybindings/mod.rs"
      to: "Action::Yank"
      via: "enum variant"
      pattern: "Yank"
---

<objective>
Implement the `y` (yank) keybinding to copy the current todo's text to the system clipboard.

Purpose: Complete the clipboard feature by wiring the keybinding to the clipboard module.
Output: Working `y` key that copies todo text with status bar feedback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-clipboard-support/01-01-SUMMARY.md

@.planning/research/PITFALLS.md

@src/keybindings/mod.rs
@src/app/event.rs
@src/app/state.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Yank action to keybindings module</name>
  <files>src/keybindings/mod.rs</files>
  <action>
    Add `Yank` to the Action enum, Display impl, FromStr impl, and default_navigate_bindings.

    1. Add enum variant (after ToggleCollapse or in a logical "clipboard" section):
       ```rust
       // Clipboard
       Yank,
       ```

    2. Add to Display impl match:
       ```rust
       Action::Yank => "yank",
       ```

    3. Add to FromStr impl match:
       ```rust
       "yank" => Ok(Action::Yank),
       ```

    4. Add default keybinding in default_navigate_bindings():
       ```rust
       m.insert("y".to_string(), "yank".to_string());
       ```

    Keybinding choice: `y` (vim yank) rather than Ctrl-C because:
    - Ctrl-C conflicts with SIGINT/terminal interrupt expectations
    - `y` is vim-native and consistent with to-tui's vim-style keybindings
    - Works reliably across all platforms without terminal-specific issues
  </action>
  <verify>cargo check passes, no duplicate keybinding warnings</verify>
  <done>Action::Yank exists and is bound to y key in Navigate mode</done>
</task>

<task type="auto">
  <name>Task 2: Implement yank handler in event.rs</name>
  <files>src/app/event.rs</files>
  <action>
    Add the yank/copy handler in execute_navigate_action function.

    1. Add import at top of file:
       ```rust
       use crate::clipboard::copy_to_clipboard;
       ```

    2. Add Action::Yank arm in the match block inside execute_navigate_action:
       ```rust
       Action::Yank => {
           if let Some(item) = state.selected_item() {
               let text = item.content.clone();
               match copy_to_clipboard(&text) {
                   Ok(()) => {
                       // Truncate display text if too long
                       let display_text = if text.len() > 40 {
                           format!("{}...", &text[..37])
                       } else {
                           text.clone()
                       };
                       state.set_status_message(format!("Copied: {}", display_text));
                   }
                   Err(e) => {
                       state.set_status_message(format!("Clipboard error: {}", e));
                   }
               }
           }
       }
       ```

    Key implementation details:
    - Copy `item.content` (plain text), NOT the full markdown line with checkbox
    - Truncate display message to prevent status bar overflow
    - Show error message on failure (CLIP-04 requirement)
    - Yank should work even in readonly mode (viewing past dates) - it's non-destructive

    DO NOT add Yank to the dominated_by_readonly list - copying is a read operation.
  </action>
  <verify>cargo check passes, cargo clippy passes with no warnings</verify>
  <done>Pressing y in Navigate mode copies todo text to clipboard with status feedback</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo check` passes without errors
- [ ] `cargo clippy` passes without warnings
- [ ] `cargo test` passes (keybinding tests)
- [ ] `cargo build --release` succeeds
- [ ] Running the TUI and pressing `y` on a todo copies its text
- [ ] Status bar shows "Copied: [text]" confirmation
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- y keybinding works in Navigate mode
- Status bar feedback shown on copy
- Error shown if clipboard unavailable
- Works on readonly days (viewing past dates)
</success_criteria>

<output>
After completion, create `.planning/phases/01-clipboard-support/01-02-SUMMARY.md`
</output>
